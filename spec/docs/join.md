# 8 Joins

A _**Referencing Term Map**_ (`rml:ReferencingTermMap`) allows
using the RDF terms generated by a [Term Map]() (`rml:TermMap`)
of another [Triples Map]() (`rml:TriplesMap`).
Since both triples maps (`rml:TriplesMap`) may be based on
different logical sources (`rml:LogicalSource`),
this may require a join between the logical sources (`rml:LogicalSource`).
This is not restricted to 1:1 joins.

## 8.1 Referencing Term Map

A [Referencing Term Map] (`rml:ReferencingTermMap`) is represented by a resource that:

* has exactly one [Parent Term Map]() (`rml:parentTermMap`) property,
whose value MUST be a Term Map (`rml:TermMap`) of the [Parent Triples Map](),
as the [Referencing Term Map]()'s [Triples Map]() is known.
* MAY have one or more [Join Conditions]()  (`rml:joinCondition`) properties.

The [Referencing Term Map]() (`rml:ReferencingTermMap`) can be
* a [Referencing Subject Map]() (`rml:ReferencingSubjectMap`)
if it constructs the subject of an RDF triple.

```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:subjectMap [ rml:parentTermMap <#SM2> ] ;

<#TM2> 
    rml:logicalSource <LS2> ;
    rml:subjectMap <#SM2> .
```
If the [Referencing Term Map]() (`rml:ReferencingTermMap`) is
a [Referencing Subject Map]() (`rml:ReferencingSubjectMap`), then
the [Parent Term Map]() (`rml:ParentTermMap`)
should construct an IRI or Blank Node.

The aforementioned could be shortcutted by using the [parent subject map]() (`rml:parentSubjectMap`) property as follows:

```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:parentSubjectMap <#SM2> .

<#TM2> 
    rml:logicalSource <LS2> ;
    rml:subjectMap <#SM2> .
```

* a [Referencing Predicate Map]() (`rml:ReferencingPredicateMap`)
if it constructs the predicate of an RDF triple.

```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:subjectMap <#SM1> ;
    rml:predicateObjectMap [
        rml:predicateMap [ rml:parentTermMap <#PM2> ] ;
        rml:objectMap <#OM1> ]. 

<#TM2> rml:subjectMap <#SM2> ;
    rml:logicalSource <LS2> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM2> ;
        rml:objectMap <#OM2> ] .
```

If the [Referencing Term Map]() (`rml:ReferencingTermMap`) is
a [Referencing Predicate Map]() (`rml:ReferencingPredicateMap`) then
the [Parent Term Map] should construct an IRI.

The aforementioned could be shortcutted using the [parent predicate map]() (`rml:parentPredicateMap`) property as follows:

```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:subjectMap <#SM1> ;
    rml:predicateObjectMap [
        rml:parentPredicateMap <#PM2> ;
        rml:objectMap <#OM1> ]. 

<#TM2> rml:subjectMap <#SM2> ;
    rml:logicalSource <LS2> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM2> ;
        rml:objectMap <#OM2> ] .
```

* a [Referencing Object Map]() (`rml:ReferencingObjectMap`)
if it constructs the object of an RDF triple.

```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:subjectMap <#SM1> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM1> ;
        rml:objectMap [ rml:parentTermMap <#OM2> ] ]. 

<#TM2> 
    rml:logicalSource <LS2> ;
    rml:subjectMap <#SM2> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM2> ;
        rml:objectMap <#OM2> ] .
```

The aforementioned could be shortcutted using the [parent object map]() (`rml:parentObjectMap`) property as follows:

```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:subjectMap <#SM1> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM1> ;
        rml:parentObjectMap <#PM2> ]. 

<#TM2> rml:subjectMap <#SM2> ;
    rml:logicalSource <LS2> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM2> ;
        rml:objectMap <#OM2> ] .
```

* a [Referencing Graph Map]() (`rml:ReferencingGraphMap`)
if it constructs the graph of an RDF triple.

```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:subjectMap <#SM1> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM1> ;
        rml:objectMap <#OM1> ]. 

<#SM1> rml:graphMap [ rml:referencingTermMap <#GM2> ] .

<#TM2> rml:subjectMap <#SM2> ;
    rml:logicalSource <LS2> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM2> ;
        rml:objectMap <#OM2> ] .

<#SM2> rml:graphMap <#GM2> .

```

The aforementioned could be shortcutted using the [parent graph map]() (`rml:parentGraphMap`) property as follows:

```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:subjectMap <#SM1> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM1> ;
        rml:objectMap <#OM1> ]. 

<#SM1> rml:referencingGraphMap <#GM2> .

<#TM2> rml:subjectMap <#SM2> ;
    rml:logicalSource <LS2> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM2> ;
        rml:objectMap <#OM2> ] .

<#SM2> rml:graphMap <#GM2> .
```

## 8.2 Parent Term Map

The [Parent Term Map]() (`rml:parentTermMap`) can be 

* a [Subject Map]() (`rml:SubjectMap')
```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:subjectMap <#SM1> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM1> ;
        rml:objectMap [ rml:parentTermMap <#SM2> ] ]. 

<#TM2> 
    rml:logicalSource <LS2> ;
    rml:subjectMap <#SM2> .
```


* a [Predicate Map]() (`rml:PredicateMap')
```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:subjectMap <#SM1> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM1> ;
        rml:objectMap [ rml:parentTermMap <#PM2> ] ]. 

<#TM2> rml:subjectMap <#SM2> ;
    rml:logicalSource <LS2> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM2> ;
        rml:objectMap <#OM2> ] .
```

* an [Object Map]() (`rml:ObjectMap')
```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:subjectMap <#SM1> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM1> ;
        rml:objectMap [ rml:parentTermMap <#OM2> ] ]. 

<#TM2> 
    rml:logicalSource <LS2> ;
    rml:subjectMap <#SM2> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM2> ;
        rml:objectMap <#OM2> ] .
```

* a [Graph Map]() (`rml:GraphMap`)
```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:subjectMap <#SM1> ;
    rml:preidcateObjectMap [
        rml:predicateMap <#PM1> ;
        rml:objectMap [ rml:parentTermMap <#GM2> ] ]. 

<#TM2> 
    rml:logicalSource <LS2> ;
    rml:subjectMap <#SM2> ;
    rml:preidcateObjectMap [
        rml:predicateMap <#PM2> ;
        rml:objectMap <#OM2> ] .

<#SM2> rml:graphMap <#GM2> .
```

### 8.2.1 Edge cases for Parent Term Maps

**Alternative 1**:
If the Referencing Term Map of the Parent Tiples Map could/should not construct any RDF triples, 
the Triples Map should not have a Subject Map and/or the Predicate Object Map should not have a Predicate or an Object Map. 
```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:subjectMap <#SM1> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM1> ;
        rml:objectMap [ rml:parentTermMap <#OM2> ] ]. 

<#TM2> 
    rml:logicalSource <LS2> ;
    rml:predicateObjectMap [
        rml:objectMap <#OM2>  ] .
```

**Alternative 2**:
If the Referencing Term Map of the Parent Tiples Map could/should not construct any RDF triples, 
the Triples Map should not have a Subject Map and the Predicate Object Map should only have a Term Map. 
```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:subjectMap <#SM1> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM1> ;
        rml:objectMap [ rml:parentTermMap <#OM2> ] ]. 

<#TM2> 
    rml:logicalSource <LS2> ;
    rml:predicateObjectMap [
        rml:termMap <#OM2>  ] .
```

**Alternative 3**:
If the Referencing Term Map of the Parent Tiples Map should not construct any RDF triples, 
the Triples Map should only have a Logical Source and a Term Map. 
```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:subjectMap <#SM1> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM1> ;
        rml:objectMap [ rml:parentTermMap <#PM2> ] ]. 

<#TM2> 
    rml:logicalSource <LS2> ;
    rml:termMap <#PM2> .
```

## 8.3 Join Condition

A [Join Condition]() is represented by a resource that
has exactly one value for each of the following two properties:

* a [child map]() (`rml:childMap`),
whose value is an [Expression Map]() (`rml:ExpressionMap'), which
MUST include references that exists in the [Logical Source]()
of the [Triples Map]() that contains the [Referencing Object Map]()
or it should have a constant value.

* a [parent map]() (`rml:parentMap`),
whose value is an [Expression Map]() (`rml:ExpressionMap'), which,
as the join condition's parent map, 
MUST include references that exists in the [Logical Source]()
of the [Referencing Object Map]()'s [Parent Triples Map]()
or it should have a constant value.

```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:subjectMap <#SM1> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM1> ;
        rml:objectMap [ 
            rml:parentTermMap <#SM2> ;
            rml:joinCondition [
                rml:childMap [ rml:reference "..."];
                rml:parentMap [ rml:template "..."]; 
            ] ] ]. 

<#TM2> 
    rml:logicalSource <LS2> ;
    rml:subjectMap <#SM2> .
```

### 8.3.1 Shortcuts

If the [Child Map]() (`rml:ChildMap`) is a reference-valued [Expression Map]() (`rml:ExpressionMap`), 
then the `rml:child` shortcut could be used.

Similarly, if the [Parent Map]() (`rml:ParentMap`) is a reference-valued [Expression Map]() (`rml:ExpressionMap`), 
then the `rml:child` shortcut could be used.

```
<#TM1> 
    rml:logicalSource <LS1> ;
    rml:subjectMap <#SM1> ;
    rml:predicateObjectMap [
        rml:predicateMap <#PM1> ;
        rml:objectMap [ 
            rml:parentTermMap <#SM2> ;
            rml:joinCondition [
                rml:child "..." ;
                rml:parent "..."]; 
            ] ] ]. 

<#TM2> 
    rml:logicalSource <LS2> ;
    rml:subjectMap <#SM2> .
```
